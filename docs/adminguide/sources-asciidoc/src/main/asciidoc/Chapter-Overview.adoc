= GMLC

[[_gmlc_overview]]
== Overview

GMLC stands for Gateway Mobile Location Centre and enables offering Location Based Services (LBS) to mobile subscribers roaming across several Mobile Network Operator's Radio Access Networks, regardless of the type of access (GERAN, UTRAN or E-UTRAN).

Existing PLMN (Public Land Mobile Network) network elements are proprietary and run on non-standard operating environments located in trusted operator’s zones which make it difficult to build and deploy new applications. Also, these network elements do not provide the tools and interfaces needed to access and retrieve data from content providers over the Internet. The GMLC connects to these network elements and enables the flow of LCS messages to be extended to an open, standards-based Application Server (AS) located in the IP network. The AS also provides the tools and interfaces to enable access to content providers through the Internet.

A GMLC is the first node an external LCS client accesses in a PLMN (Public Land Mobile Network). There may be more than one GMLC in a PLMN.

The simplest location information a GMLC can retrieve is by issuing a MAP ATI (Any Time Interrogation) request to the HLR (Home Location register). MAP ATI is part of CAMEL phase 1. If the GMLC is allowed to proceed with the operation at the HLR, the latter will respond with the Cell Global Identity (CGI) as for the latest MAP Update Location operation carried out between the HLR and VLR at which the target mobile equipment is attached too (therefore, an additional parameter known as "Age of Location Information" is also included in the response). As shown in the figure below taken from 3GPP TS 23.003, CGI is made up of multiple components, namely, MCC (Mobile Country Code), MNC (Mobile Network Code), LAC (Location Area Code) and CI (Cell Identity). The combination of MCC and MNC represents the PLMN at which the cell is located, in other words, the country and Mobile Network Operator it belongs to. LAC represents a geographic location area in which a cluster of Base Transceiver Stations (BTS) are located for radio access, while CI, uniquely identifies the BTS providing service to the target subscriber in that area (more commonly known as cell). From CAMEL phase 4 compliance onward, MAP ATI can also retrieve the IMEI and MS Classmark.


image::images/CGI.png[Cell Global Identity, align="center"]

CGI represents the location information with greatest error margin retrievable by a GMLC in GSM based core networks.

As for 3GPP specs, hypothetically a Stand-Alone SMLC
can be placed within the BSC for triggering more precise location procedures, but in practice this is hardly found. More accurate positioning methods were developed for cellular networks, particularly from 3G (UMTS) and beyond. Naturally, accuracy comes with a price. When these dearer location capabilities are available, the GMLC may request routing information from the HLR via the Lh interface or HSS (Home Subscriber Server) via the SLh/Lh interface.

image::images/LCS-GSM-UMTS.png[]

While Lh interface resides in a Circuit-Switched Core Network and therefore demands SS7 MAP operations, SLh is placed in the Evolved Packet Core (EPC) and is a Diameter-based interface for LTE location services, as specified by 3GPP TS 29.173. After performing registration authorization, it may send positioning requests to either VMSC (Visited Mobile Switching Centre), SGSN (Serving GPRS Support Node), MSCS (Mobile Switching Centre Server) or MME (Mobility Management Entity) and receives final location estimates from the corresponding entity via  the Lg, Lgd or SLg interface. Again, Lg/Lgd interfaces demand SS7 MAP operations while SLg is a Diameter-based interface for LTE location occupying ELP procedures, where ELP stands for EPC Location Protocol as specified by 3GPP TS 29.172.

image::images/LCS-LTE.png[]

In summary, location information retrieval within the control plane of a Mobile Core Network is done through the GMLC and its counterparts, the Stand-Alone Serving Mobile Location Centre (SAS) for location within the UTRAN (UMTS Terrestrial Radio Access Network) or Enhanced-SMLC (E-SMLC) for location within the E-UTRAN (Enhanced-UTRAN or LTE), along with the positioning methods available in the RAN (OTDOA, UTDOA, E-OTD, etc.). Location information retrieval in the control plane is performed through a positioning system using OMA’s Secure User Plane Location (SUPL) protocol, also known as SLP (SUPL Location Platform). Control plane positioning is depicted in previous figure too, although it's not part of {this-platform} {this-application} albeit it's in TeleStax' R&D roadmap. Moreover, SUPL demands SETs (SUPL Enabled Terminals), which scarce nowadays. Nevertheless, it's placed there as it will be added in the future and a combination of a solution in either planes is considered the ideal by the industry for location services in Next Generation Networks.


Up to this point, what is known as "Immediate Location Request" has been covered. A GMLC can also handle "Deferred Location Request", which represents retrieving of location contingent on some current or future events where the response from the LCS Server to the LCS Client may occur some time after the request was sent, as described in 3GPP TS 23.271. When a deferred location request is triggered by the GMLC, event-based "Subscriber Location Reports", either conveyed through MAP or ELP are sent back to the GMLC by the entity at which the target mobile equipment is attached to (VMSC, MSCS, SGSN or MME).

Next figure exhibits {this-platform} {this-application} architecture and interfaces with aforementioned entities and RestComm (and particularly, RestComm Geolocation API).

image::images/GMLC-RestComm-MNO.png[]

Finally, {this-platform} {this-application} supports the following MAP and Diameter-based operations for LCS (Location Services) within Mobile Network Operators (some of them are under development, check next sections for further details):

* MAP ATI: Any-Time-Interrogation, to gather Cell Global Identity, age of location information and state of the target mobile station from the HLR.
* MAP SRIforLCS: Send Routing Information for Location Services, to gather IMSI and core network entity address (MSC or SGSN) to which send further location request.
* MAP PSL: Provide Subscriber Location, to gather location information from the UTRAN (UMTS Terrestrial Radio Access Network), which should include, besides Cell Global Identity,  location estimates in geographic coordinates of the target User Equipment, depending on available positioning methods (e.g. E-OTD, OTDOA, UTDOA, A-GPS, etc.).
* MAP SLR: Subscriber Location Report, to gather location of a target User Equipment from the MSC or SGSN when a request for location is either implicitly administered or made at some earlier time in MAP PSL for event based deferred type of location.
* Diameter Routing Information Request/Answer (RIR/RIA): analogous to MAP SRIforLCS but over Diameter based SLh interface between GMLC and HSS.
* ELP Provide Location Request/Answer (PLR/PLA): analogous to MAP PSL but over Diameter-based Evolved Packet Core Location Protocol (ELP) SLg interface between GMLC and MME.
* ELP Location Report Request/Answer (LRR/LRA): analogous to MAP SLR, but over Diameter-based Evolved Packet Core Location Protocol (ELP) SLg interface between GMLC and MME.

== Message Flow

=== HTTP and MAP messages flow for GSM Location Services

GMLC service begins when the network sends an HTTP (GET/POST) request to the GMLC.

Next figure displays the signal flow between an application and {this-platform} {this-application} within an GSM Core Network, from where location services are reduced to retrieving Global Cell Identity, Age of Location information and MSC/VLR address at which the target MSISDN is currently attached to, by means of a MAP ATI request to the HLR (subscriber’s state can be included in the response if requested in MAP ATI, from which «assumedIdle», «camelBusy» or «notProvidedByVlr» are the available responses). The application, via a REST Web Service, delivers an HTTP GET request to {this-platform} {this-application}. {this-platform} {this-application} then performs a MAP ATI request to the concerning GSM Core Network HLR and receives the corresponding response with location information as previously stated.

image::images/App-GMLC-GSM_flow.png[]

A deeper look inside the messages exchanged as for the previous diagram is shown next (all information depicted are fictitious, as an example)

HTTP GET:
....
Internet Protocol Version 4, Src: 192.168.26.1, Dst: 192.168.26.128
Transmission Control Protocol, Src Port: 48200 (48200), Dst Port: 8080 (8080), Seq: 1, Ack: 1, Len: 509
Hypertext Transfer Protocol
    GET /restcomm/gmlc/rest?msisdn=59899077937 HTTP/1.1\r\n
        [Expert Info (Chat/Sequence): GET /restcomm/gmlc/rest?msisdn=59899077937 HTTP/1.1\r\n]
        Request Method: GET
        Request URI: /restcomm/gmlc/rest?msisdn=59899077937
        Request Version: HTTP/1.1
....

MAP ATI Request

....
IP 4, Src: 192.168.26.128, Dst: 41.188.110.5
SCTP, Src Port: 8012 (8012), Dst Port: 8011 (8011)
MTP 3 User Adaptation Layer (M3UA)
SCCP
    Called Party address
        SubSystem Number: HLR (Home Location Register) (6)
        Global Title 0x4 (9 bytes)
            Called Party Digits: 59899077937
    Calling Party address
        SubSystem Number: GMLC(MAP) (145)
        Global Title 0x4 (6 bytes)
            Calling Party Digits: 222333
TCAP
    begin
        dialogueRequest
            application-context-name: 0.4.0.0.1.0.29.3 (anyTimeInfoEnquiryContext-v3)
        components: 1 item
            Component: invoke
                    invokeID: 0
                    opCode: localValue: 71
GSM MAP
    Component: invoke (1)
        invoke
            invokeID: 0
            opCode: anyTimeInterrogation (71)
            subscriberIdentity: msisdn (1)
                msisdn: 919598097739f7
            requestedInfo
                locationInformation
                subscriberState
            gsmSCF-Address: 91223233
....

MAP ATI Response

....
IP 4, Src: 41.188.110.5, Dst: 192.168.26.128
SCTP, Src Port: 8011 (8011), Dst Port: 8012 (8012)
MTP 3 User Adaptation Layer (M3UA)
SCCP
    Called Party address
        SubSystem Number: GMLC(MAP) (145)
        Global Title 0x4 (6 bytes)
            Calling Party Digits: 222333
    Calling Party address
        SubSystem Number: HLR (Home Location Register) (6)
        Global Title 0x4 (9 bytes)
            Called Party Digits: 59899077937
TCAP
    end
        Destination Transaction ID
        oid: 0.0.17.773.1.1.1 (id-as-dialogue)
        dialogueResponse
            application-context-name: 0.4.0.0.1.0.29.3 (anyTimeInfoEnquiryContext-v3)
            result: accepted (0)
        components: 1 item
            Component: returnResultLast
                    invokeID: 0
                    opCode: localValue: 71
GSM MAP
    Component: returnResultLast (2)
        returnResultLast
            invokeID: 0
            resultretres
                opCode: localValue (0)
                    localValue: anyTimeInterrogation (71)
                subscriberInfo
                    locationInformation
                        ageOfLocationInformation: 5
                        geographicalInformation: 104f01231f9a0e00
                        vlr-number: 915555556566
                        cellGlobalIdOrServiceAreaIdOrLAI: cellGlobalIdOrServiceAreaIdFixedLength: 52f0107d0000dd
                    subscriberState: assumedIdle (0)
                        assumedIdle
....

HTTP GET Response:

....
IP Version 4, Src: 192.168.26.128, Dst: 192.168.26.1
Transmission Control Protocol, Src Port: 8080 (8080), Dst Port: 48200 (48200), Seq: 230, Ack: 510, Len: 5
Hypertext Transfer Protocol
    HTTP/1.1 200 OK\r\n
        [Expert Info (Chat/Sequence): HTTP/1.1 200 OK\r\n]
        Request Version: HTTP/1.1
        Status Code: 200
        Response Phrase: OK
    [HTTP response 1/1]
    [Time since request: 0.341487879 seconds]
    [Request in frame: 10]
    HTTP chunked response
        Data chunk (61 octets)
        End of chunked encoding
        \r\n
    Data (61 bytes)  mcc=250,mnc=1,lac=32000,cellid=221,aol=5,vlrNumber=5555555666
....

The latter describes a success scenario, where the application gets the following answer to it HTTP GET tequest:

....
mcc=250,mnc=1,lac=32000,cellid=221,aol=5,vlrNumber=5555555666
....

Following, some non succesful HTTP GET responses are displayed:

MAP ATI response with Subscriber State but no Location Information received:
....
SubscriberState: SubscriberState [subscriberStateChoice=netDetNotReachable, notReachableReason=notRegistered]
....

MAP ATI response received with no Subscriber Information:
....
Unknown SubscriberInfo received: xxxx
....

Erroneous MAP ATI response received:
....
Unknown AnyTimeInterrogationResponse received: xxxx
....

MAP ATI response received with UnknownSubscriber error:
....
ReturnError: 1 : MAPErrorMessageUnknownSubscriber [, unknownSubscriberDiagnostic=imsiUnknown]
....

MAP ATI response received with other error messages:
....
ReturnError: <error code> : <MAP Error message description>
ReturnError: 34 : MAPErrorMessageSystemFailure [networkResource=hlr]
....

When MSISDN is absent in the GET HTTP request - bad HTTP request syntax:
....
Invalid MSISDN specified
....

When a timeout occurs (e.g. no response from an HLR is received):
....
DialogTimeout
....

When other SS7 stack errors happen:
....
DialogReject: <description>
....
....
DialogProviderAbort: <description>
....
....
DialogUserAbort: <description>
....
....
RejectComponent: <description>
....


Next figure displays the analogous signal flow as the one explained before, but including RestComm Geolocation API between the application and {this-platform} {this-application}. Likewise, in this case, the MAP ATI request is triggered by RestComm by an HTTP POST request with MLP Standard Location Immediate Request (SLIR).

image::images/RestComm-GMLC-GSM_flow.png[]

Following, see an example of MLP payload included in HTTP POST request received by {this-platform} {this-application}:

....
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svc_init SYSTEM "MLP_SVC_INIT_310.DTD">
<svc_init xmlns="MLP_SVC_INIT_310.dtd">
	<hdr>
		<client>
       			<id>USERNAME</id>
       			<pwd>PASSWORD</pwd>
       			<serviceid>SERVICEID</serviceid>
     		</client>
   	</hdr>
   	<slir>
     		<msids>
       			<msid type="MSISDN">59899077937</msid>
     		</msids>
     		<loc_type type=""CURRENT_OR_LAST" />
    </slir>
</svc_init>
....

The corresponding answer to the MLP SLIR request (after reception of MAP ATI response from the HLR), i.e. the MLP SLIA (Standard Location Immediate Answer) is shown next:

....
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svc_result SYSTEM "MLP_SVC_RESULT_310.DTD">
<svc_result xmlns="MLP_SVC_RESULT_310.dtd" ver="3.1.0">
    <slia ver="3.1.0">
        <pos>
            <msid>59899077937</msid>
            <pd>
                <time utc_off="-0300">20160828181421</time>
                <plmn>
                    <mcc>250</mcc>
                    <mnc>1</mnc>
                </plmn>
                <gsm_net_param>
                    <cgi>
                        <mcc>250</mcc>
                        <mnc>1</mnc>
                        <lac>32000</lac>
                        <cellid>221</cellid>
                    </cgi>
                    <neid>
                        <vlrid>
                            <vlrno>5555555666</vlrno>
                        </vlrid>
                    </neid>
                </gsm_net_param>
            </pd>
        </pos>
    </slia>
</svc_result>
....

An MLP SLIA including an unsuccessful location information retrieval due to "Unknown Subscriber" error received in MAP ATI response is shown next.

....
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svc_result SYSTEM "MLP_SVC_RESULT_310.DTD">
<svc_result xmlns="MLP_SVC_RESULT_310.dtd" ver="3.1.0">
    <slia ver="3.1.0">
        <result resid="4">UNKNOWN SUBSCRIBER</result>
        <add_info>ReturnError: 1 : MAPErrorMessageUnknownSubscriber [, unknownSubscriberDiagnostic=imsiUnknown]</add_info>
    </slia>
</svc_result>
....

An MLP SLIA including an unsuccessful location information retrieval due to "System Failure" error received in MAP ATI response is shown next.

....
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svc_result SYSTEM "MLP_SVC_RESULT_310.DTD">
<svc_result xmlns="MLP_SVC_RESULT_310.dtd" ver="3.1.0">
    <slia ver="3.1.0">
        <result resid="1">SYSTEM FAILURE</result>
        <add_info>ReturnError: 34 : MAPErrorMessageSystemFailure [networkResource=hlr]</add_info>
    </slia>
</svc_result>
....


=== HTTP and MAP messages flow for UMTS Location Services

UMTS Location Services under SS7 MAP Location Services Management (LSM) set of operations are currently under final stages of implementation and deployment.
Every trace or log described next are taken from the work already done, including stress tests from MAP Stub for the aforementioned set of operations.

Following figure displays the signaling call flow between an application, RestComm Geolocation API and {this-platform} {this-application} within an UMTS Core Network. The term RAN (Radio Access Network) might involve the RNC (Radio Network Controller), a Stand-Alone SMLC (Serving Mobile Location Centre), the NB (Node B -base station-) and the UE (User Equipment).

image::images/RestComm-GMLC-UMTS_flow.png[]

The terms MLP SLIR/SLIA and SLIREP stand for Mobile Location Protocol Standard Location Immediate Request/Response/Report as for OMA (Open Mobile Alliance) Mobile Location Protocol 3.2 specification.

Next figure shows an example signal flow exclusively between {this-platform} {this-application} within an UMTS Core Network for location retrieval by means of MAP operations destined to a Circuit-Switched Core Network where a Stand-Alone SMLC (Serving Mobile Location Center) is operational and positioning methods are available at the Radio Access Network (e.g. OTDOA). Then, UMTS Terrestrial Radio Access Network (UTRAN) comprises positioning procedures involving the Stand-Alone SMLC (SAS), NB (Node Basestation), and the UE.The example considers a location report sent back to {this-platform} {this-application}, triggered by an event previously armed at the Radio Access Network (e.g. a UE exiting a geofence).

image::images/GMLC-UMTS_call_flow.png[]

=== HTTP and Diameter-based messages flow for LTE Location Services

As for UMTS Location Services under SS7 MAP Location Services Management (LSM) set of operations, LTE location services are also under final stages of implementation and deployment.
Every trace or log described next are taken from the work already done, which includes already developed SLh and SLg interfaces in jDiameter, while JAIN SLEE resource adaptors for these interfaces are in a very advanced state of development (peer reviewing and QA).

Next figure shows an example signaling call flow exclusively between {this-platform} {this-application} within an Evolved Packet Core Network for location retrieval by means of Diameter based procedures as for 3GPP TS 29.172 and 29.173 (i.e. SLg and SLh interfaces). These Diameter requests are destined to a Packet-Switched Core Network like LTE's EPC, where an Evolved-SMLC is operational and positioning methods are available at the Radio Access Network (e.g. OTDOA). Then, LTE's Radio Access Network (EUTRAN) involves positioning procedures comprising the E-SMLC (Evolved SMLC), eNB (evolved NB), and the UE. The example considers a location report sent back to {this-platform} {this-application}, triggered by an event previously armed at the Radio Access Network (e.g. a UE entering a geofence).

image::images/GMLC-LTE_call_flow.png[]

Next figure displays the analogue call flow as previous, but including RestComm Geolocation API and {this-platform} {this-application} within an EPS (Evolved Packet System) for LTE/LTE-Advanced/LTE-Pro location services.

image::images/RestComm-GMLC-LTE_flow.png[]

An analogous signal call flow as the one explained before for GSM location but consistent with previous signal flow for LTE location is described next. The mentioned MLP SLIR example would be almost identical to the one shown for GSM location, but with some additions as following:

....
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svc_init SYSTEM "MLP_SVC_INIT_310.DTD">
<svc_init xmlns="MLP_SVC_INIT_310.dtd">
    <hdr>
        <client>
            <id>ACae6e420f425248d6a26948c17a9e2acf</id>
            <pwd>f8bc1274677b173d1a1cf3b9924eaa7e</pwd>
            <serviceid>0005</serviceid>
        </client>
    </hdr>
    <slir>
        <msids>
            <msid type="MSISDN">59899077937</msid>
        </msids>
        <loc_type type="CURRENT" />
		<geo_info>
			<CoordinateReferenceSystem>
				<Identifier>
					<code>4004</code>
					<codeSpace>EPSG</codeSpace>
					<edition>6.1</edition>
				</Identifier>
			</CoordinateReferenceSystem>
		</geo_info>
		<change_area>
			<target_area>
				<name_area>a51</name_area>
			</target_area>
			<type>MS_WITHIN_AREA</type>
			<loc_estimates>FALSE</loc_estimates>
			<no_of_reports>1</no_of_reports>
		</change_area>
		<duration>3600</duration>
		<lcs_ref>579</lcs_ref>
	</slir>
</svc_init>
....

Corresponding transmission of ELP PLR to the LTE network
is shown next (only AVPs shown for simplicity):

....
[PLR] Sending Request: 8388620 [E2E:1263534084 -- HBH:1693441831 -- AppID:16777255]
[PLR] Request AVPs:
[PLR] <avp name="Session-Id" code="263" vendor="0" value="51.0.0.1;343; 3840918879;SLg-PLA34277987203" />
[PLR] <avp name="Vendor-Specific-Application-Id" code="260" vendor="0">
[PLR]   <avp name="Vendor-Id" code="266" vendor="0" value="10415" />
[PLR]   <avp name="Auth-Application-Id" code="258" vendor="0" value="16777255" />
[PLR] </avp>
[PLR] <avp name="Destination-Realm" code="283" vendor="0" value="tel1.com" />
[PLR] <avp name="Origin-Realm" code="296" vendor="0" value="restcomm.com" />
[PLR] <avp name="Auth-Session-State" code="277" vendor="0" value="1" />
[PLR] <avp name="Origin-Host" code="264" vendor="0" value="aaa://51.0.0.1:13868" />
[PLR] <avp name="SLg-Location-Type" code="2500" vendor="10415" value="0" />
[PLR] <avp name="MSISDN" code="701" vendor="10415" value="59899077937" />
[PLR] <avp name="LCS-EPS-Client-Name" code="2501" vendor="10415">
[PLR]   <avp name="LCS-Name-String" code="1238" vendor="10415" value=" ACae6e420f425248d6a26948c17a9e2acf" />
[PLR]   <avp name="LCS-Format-Indicator" code="1237" vendor="10415" value="2" />
[PLR] </avp>
[PLR] <avp name="LCS-Client-Type" code="1241" vendor="10415" value="1" />
[PLR] <avp name="LCS-Requestor-Name" code="2502" vendor="10415">
[PLR]   <avp name="LCS-Requestor-Id-String" code="1240" vendor="10415" value="Restcomm Geolocation API" />
[PLR]   <avp name="LCS-Format-Indicator" code="1237" vendor="10415" value="0" />
[PLR] </avp>
[PLR] <avp name="LCS-Priority" code="2503" vendor="10415" value="1" />
[PLR] <avp name="LCS-QoS" code="2504" vendor="10415">
[PLR]   <avp name="LCS-QoS-Class" code="2523" vendor="10415" value="1" />
[PLR]   <avp name="Horizontal-Accuracy" code="2505" vendor="10415" value="120" />
[PLR]   <avp name="Vertical-Accuracy" code="2506" vendor="10415" value="99999" />
[PLR]   <avp name="Vertical-Requested" code="2507" vendor="10415" value="0" />
[PLR]   <avp name="Response-Time" code="2509" vendor="10415" value="1" />
[PLR] </avp>
[PLR] <avp name="Deferred-Location-Type" code="2532" vendor="10415" value="4" />
[PLR] <avp name="LCS-Reference-Number" code="2531" vendor="10415" value="579" />
[PLR] <avp name="Area-Event-Info" code="2533" vendor="10415">
[PLR]   <avp name="Occurrence-Info" code="2538" vendor="10415" value="0" />
[PLR]   <avp name="Interval-Time" code="2539" vendor="10415" value="3600" />
[PLR] </avp>
[PLR] <avp name="Area-Definition" code="2534" vendor="10415">
[PLR]   <avp name="Area-Type" code="2536" vendor="10415" value="2" />
[PLR]   <avp name="Area-Identification" code="2537" vendor="10415" value="a51" />
[PLR] </avp>
[PLR] <avp name="PLR-Flags" code="2545" vendor="10415" value="4" />
[PLR] <avp name="Area-Event-Info" code="2533" vendor="10415">
[PLR]   <avp name="Reporting-Amount" code="2541" vendor="10415" value="1" />
[PLR]   <avp name="Reporting-Interval" code="2542" vendor="10415" value="3600" />
[PLR] </avp>
[PLR] </avp>
[PLR] <avp name="GMLC-Address" code="2405" vendor="10415" value="52.21.78.91" />
[PLR] <avp name="PLR-Flags" code="2545" vendor="10415" value="4" />
[PLR] </avp>
....

Reception of ELP PLA from the LTE network is shown next (only AVPs shown for simplicity):

....
[PLA] Received Answer: 8388620 [E2E:1263534084 -- HBH:1693441831 -- AppID:16777255]
[PLA] Request AVPs:
[PLA] <avp name="Session-Id" code="263" vendor="0" value="51.0.0.1;343; 3840918879;SLg-PLA34277987203" />
[PLA] <avp name="Vendor-Specific-Application-Id" code="260" vendor="0">
[PLA] <avp name="Vendor-Id" code="266" vendor="0" value="10415" />
[PLA] <avp name="Auth-Application-Id" code="258" vendor="0" value="16777255" />
[PLA] </avp>
[PLA] <avp name="Result-Code" code="268" vendor="0" value="2001" />
[PLA] <avp name="Auth-Session-State" code="277" vendor="0" value="1" />
[PLA] <avp name="Location-Estimate" code="1242" vendor="10415" value="S35°38'15.37" W58°45'21.77"" />
[PLA] <avp name="Accuracy-Fulfilment-Indicator" code="2513" vendor="10415" value="0" />
[PLA] <avp name="Age-Of-Location-Estimate" code="2514" vendor="10415" value="0" />
[PLA] <avp name="EUTRAN-Positioning-Data" code="2516" vendor="10415" value="0A73F937" />
[PLA] <avp name="ECGI" code="2517" vendor="10415" value="EFB9437" />
[PLA] <avp name="Serving-Node" code="2401" vendor="10415">
[PLA]   <avp name="SGSN-Number" code="1489" vendor="10415" value="59899004501" />
[PLA]	<avp name="SGSN-Name" code="2409" vendor="10415" value="SGSN01" />
[PLA]	<avp name="SGSN-Realm" code="2410" vendor="10415" value="sgsn.tel1.com" />
[PLA]   <avp name="MME-Name" code="2402" vendor="10415" value="MME710" />
[PLA]   <avp name="MME-Realm" code="2408" vendor="10415" value="mme.tel1.com" />
[PLA]   <avp name="3GPP-AAA-Server-Name" code="318" vendor="10415" value="aaa.restcomm.com" />
[PLA]   <avp name="LCS-Capabilities-Sets" code="2404" vendor="10415" value="99900123" />
 [PLA]   <avp name="GMLC-Address" code="2405" vendor="10415" value="52.21.78.91" />
[PLA] </avp>
[PLA] <avp name="PLA-Flags" code="2546" vendor="10415" value="0" />
[PLA] <avp name="ESMLC-Cell-Info" code="2552" vendor="10415">
[PLA]  <avp name="ECGI" code="2517" vendor="10415" value="EFB9437" />
[PLA]  <avp name="Cell-Portion-ID" code="2553" vendor="10415" value="0" />
[PLA] </avp>
....

The corresponding answer to the MLP SLIR request (after reception of ELP PLA from the LTE network), i.e. the MLP SLIA (Standard
Location Immediate Answer) embedded in HTTP POST response is shown next.

....
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svc_result SYSTEM "MLP_SVC_RESULT_310.DTD">
<svc_result xmlns="MLP_SVC_RESULT_310.dtd" ver="3.1.0">
    <slia ver="3.1.0">
        <lcs_ref>579</lcs_ref>
        <pos>
            <msid>59899077937</msid>
            <pd>
                <time utc_off="-0300">20161023235151</time>
		        <geo_info>
			        <CoordinateReferenceSystem>
				        <Identifier>
					        <code>4326</code>
					        <codeSpace>EPSG</codeSpace>
					        <edition>6.1</edition>
				        </Identifier>
			        </CoordinateReferenceSystem>
			        <shape>
			            <CircularArea>
			                <coord>
			                    <X>35 38 15.37S</X>
			                    <Y>58 45 21.77W</Y>
			                </coord>
			                <radius>-1</radius>
			            </CircularArea>
			        </shape>
		        </geo_info>
		    </pd>
	    </pos>
    </slia>
</svc_result>
....

When the settled event occurs, it triggers a location report back to the GMLC, the ELP LRR/LRA messages are subsequently conveyed back and forth between the MME and GMLC, as displayed next:

....
[LRR] Sending Request: 8388621 [E2E:1370488836 -- HBH:1693543583 -- AppID:16777255]
[LRR] Request AVPs:
[LRR] <avp name="Session-Id" code="263" vendor="0" value="51.0.0.1;343; 3841024432;-SLg-LRR34277987203" />
[LRR] <avp name="Vendor-Specific-Application-Id" code="260" vendor="0">
[LRR]   <avp name="Vendor-Id" code="266" vendor="0" value="10415" />
[LRR]   <avp name="Auth-Application-Id" code="258" vendor="0" value="16777255" />
[LRR] </avp>
[LRR] <avp name="Destination-Realm" code="283" vendor="0" value="restcomm.com" />
[LRR] <avp name="Origin-Realm" code="296" vendor="0" value="tel1.com" />
[LRR] <avp name="Auth-Session-State" code="277" vendor="0" value="1" />
[LRR] <avp name="Origin-Host" code="264" vendor="0" value="aaa://51.0.0.1:13868" />
[LRR] <avp name="Location-Event" code="2518" vendor="10415" value="4" />
[LRR] <avp name="LCS-EPS-Client-Name" code="2501" vendor="10415">
[LRR]   <avp name="LCS-Name-String" code="1238" vendor="10415" value="ACae6e420f425248d6a26948c17a9e2acf" />
[LRR]   <avp name="LCS-Format-Indicator" code="1237" vendor="10415" value="2" />
[LRR] </avp>
[LRR] <avp name="3GPP-IMSI" code="1" vendor="10415" value="748039876543210" />
[LRR] <avp name="MSISDN" code="701" vendor="10415" value="59899077937" />
[LRR] <avp name="IMEI" code="1402" vendor="10415" value="011714004661057" />
[LRR] <avp name="Location-Estimate" code="1242" vendor="10415" value=" S35°37'10.91" W58°01'33.07"" />
[LRR] <avp name="Accuracy-Fulfilment-Indicator" code="2513" vendor="10415" value="0" />
[LRR] <avp name="Age-Of-Location-Estimate" code="2514" vendor="10415" value="3" />
[LRR] <avp name="Velocity-Estimate" code="2515" vendor="10415" value="0" />
[LRR] <avp name="EUTRAN-Positioning-Data" code="2516" vendor="10415" value="0A73F937" />
[LRR] <avp name="ECGI" code="2517" vendor="10415" value="E1F0023" />
[LRR] <avp name="Service-Area-Identity" code="1607" vendor="10415" value="service-area-umts-3" />
[LRR] <avp name="LCS-Service-Type-ID" code="2520" vendor="10415" value="234" />
[LRR] <avp name="Pseudonym-Indicator" code="2519" vendor="10415" value="0" />
[LRR] <avp name="LCS-QoS-Class" code="2523" vendor="10415" value="1" />
[LRR] <avp name="Serving-Node" code="2401" vendor="10415">
[LRR]   <avp name="SGSN-Number" code="1489" vendor="10415" value="59899004501" />
[LRR]	<avp name="SGSN-Name" code="2409" vendor="10415" value="SGSN01" />
[LRR]	<avp name="SGSN-Realm" code="2410" vendor="10415" value="sgsn.tel1.com" />
[LRR]   <avp name="MME-Name" code="2402" vendor="10415" value="MME710" />
[LRR]   <avp name="MME-Realm" code="2408" vendor="10415" value="mme.tel1.com" />
[LRR]   <avp name="3GPP-AAA-Server-Name" code="318" vendor="10415" value="aaa.restcomm.com" />
[LRR]   <avp name="LCS-Capabilities-Sets" code="2404" vendor="10415" value="99900123" />
 [PLA]   <avp name="GMLC-Address" code="2405" vendor="10415" value="52.21.78.91" />
 [LRR] </avp>
[LRR] <avp name="LRR-Flags" code="2530" vendor="10415" value="0" />
[LRR] <avp name="LCS-Reference-Number" code="2531" vendor="10415" value="579" />
[LRR] <avp name="Deferred-MT-LR-Data" code="2547" vendor="10415">
[LRR]   <avp name="Deferred-Location-Type" code="2532" vendor="10415" value="4" />
[LRR]   <avp name="Termination-Cause" code="2548" vendor="10415" value="7" />
[LRR] </avp>
[LRR] <avp name="GMLC-Address" code="2405" vendor="10415" value="52.21.78.91" />
[LRR] <avp name="Periodic-LDR-Info" code="2540" vendor="10415">
[LRR]   <avp name="Reporting-Amount" code="2541" vendor="10415" value="8639910" />
[LRR]   <avp name="Reporting-Interval" code="2542" vendor="10415" value="8639998" />
[LRR] </avp>
[LRR] <avp name="ESMLC-Cell-Info" code="2552" vendor="10415">
[LRR]   <avp name="ECGI" code="2517" vendor="10415" value="EFC9452" />
[LRR]   <avp name="Cell-Portion-ID" code="2553" vendor="10415" value="12393" />
[LRR] </avp>
[LRR] <avp name="1xRTT-RCID" code="2554" vendor="10415" value="00000010" />
[LRR] <avp name="Civic-Address" code="2556" vendor="10415" value="<civicAddress xml:lang='en-GB' xmlns="urn:ietf:params:xml:ns:pidf:geopriv10:civicAddr" xmlns:cdc="http://devon.canals.example.com/civic">
        <country>UY</country>
	<A1>MV</A1>
	<ap:airport>MVD</ap:airport>
	<ap:terminal>Carrasco International</ap:terminal>
	<ap:concourse>A</ap:concourse>
	<ap:gate>4</ap:gate>
      </civicAddress>" />
[LRR] <avp name="Barometric-Pressure" code="2557" vendor="10415" value="101327" />
....

....
[LRA] Received Answer: 8388621 [E2E:1370488836 -- HBH:1693543583 -- AppID:16777255]
[LRA] Request AVPs:
[LRA] <avp name="Session-Id" code="263" vendor="0" value="51.0.0.1;343; 3841024432;-SLg-LRR34277987203" />
[LRA] <avp name="Vendor-Specific-Application-Id" code="260" vendor="0">
[LRA]   <avp name="Vendor-Id" code="266" vendor="0" value="10415" />
[LRA]   <avp name="Auth-Application-Id" code="258" vendor="0" value="16777255" />
[LRA] </avp>
[LRA] <avp name="Result-Code" code="268" vendor="0" value="2001" />
[LRA] <avp name="Auth-Session-State" code="277" vendor="0" value="1" />
[LRA] <avp name="GMLC-Address" code="2405" vendor="10415" value="52.21.78.91" />
[LRA] <avp name="LRA-Flags" code="2549" vendor="10415" value="0" />
[LRA] <avp name="Reporting-PLMN-List" code="2543" vendor="10415">
[LRA]   <avp name="Visited-PLMN-Id" code="1407" vendor="10415" value="74803, 74801" />
[LRA]   <avp name="Periodic-Location-Support-Indicator" code="2550" vendor="10415" value="1" />
[LRA]   <avp name="Prioritized-List-Indicator" code="2551" vendor="10415" value="0" />
[LRA] </avp>
[LRA] <avp name="PLMN-ID-List" code="2544" vendor="10415">
[LRA]   <avp name="Visited-PLMN-Id" code="1407" vendor="10415" value="74803, 74801" />
[LRA]   <avp name="Periodic-Location-Support-Indicator" code="2550" vendor="10415" value="1" />
[LRA] </avp>
[LRA] <avp name="LCS-Reference-Number" code="2531" vendor="10415" value="579" />
[LRR] <avp name="Origin-Host" code="264" vendor="0" value="51.0.0.1" />
[LRR] <avp name="Origin-Realm" code="296" vendor="0" value="restcomm.com" />
....

The corresponding answer MLP SLREP (Standard Location Immediate Answer) embedded in HTTP POST response is shown next.

....
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svc_result SYSTEM "MLP_SVC_RESULT_310.DTD">
<svc_result xmlns="MLP_SVC_RESULT_310.dtd" ver="3.1.0">
    <slirep ver="3.1.0">
        <lcs_ref>579</lcs_ref>
	    <pos>
	        <msid>59899077937</msid>
	        <imsi>748039876543210</imsi>
 	        <imei>011714004661057</imei>
 	        <speed>0</speed>
            <pd>
                <time utc_off="-0300">20161023235901</time>
		        <geo_info>
			        <CoordinateReferenceSystem>
				        <Identifier>
					        <code>4326</code>
					        <codeSpace>EPSG</codeSpace>
					        <edition>6.1</edition>
				        </Identifier>
			        </CoordinateReferenceSystem>
			        <shape>
			            <CircularArea>
			                <coord>
			                    <X>35 37 10.91S</X>
			                    <Y>58 01 33.07W</Y>
			                </coord>
			                <radius>100</radius>
			            </CircularArea>
			        </shape>
		        </geo_info>
		    </pd>
	    </pos>
    </slirep>
</svc_result>
....


[[_restcomm_gmlc_overview]]
== {this-platform} {this-application}

[[_restcomm_gmlc_overview_features]]
=== Major Features

{this-platform} {this-application} implementation of GMLC is the first and only open source GMLC with a host of rich features and advantages.

Java-based:::
  {this-platform} {this-application} is the only Java based GMLC Gateway.
  It is robust and reliable and can be installed on any Operating System that supports Java (JDK 7 and SCTP).

Open Source:::
  The Software is open-source, giving you the freedom to understand the code and customise it to your enterprise needs.
  It is supported by a vibrant Open source community.

Carrier Grade Performance:::
  {this-platform} {this-application} has been developed to be deployed at Mobile Network Operators around the world so as to process billions of LCS transactions every day.
  A single {this-platform} {this-application} node can process up to 1500's LCS/sec and can be adapted to the needs of Communication Service Providers of different sizes in any country reducing  CAPEX and OPEX costs.

Cloud Ready:::
  {this-platform} {this-application} is Cloud-ready.
  It can be deployed on dedicated hardware, private cloud infrastructure or public IaaS such as AWS.

SS7 Hardware Cards:::
  {this-platform} {this-application} can be used with Intel family boards (Dialogic SS7 cards) or Zaptel/Dahdi compatible TDM devices (Digium, Sangoma).  For production its recommended to use Dialogic boards only.

SIGTRAN (M3UA):::
  It also has in-built support for SIGTRAN (M3UA using SCTP).

Diameter-based SLh and SLg (ELP):::
  {this-platform} {this-application} also has in-built support for LCS in LTE networks.

HTTP interface:::
  {this-platform} {this-application} HTTP interface is a common interface that can be used for connection with service applications. {this-platform} {this-application} supports network/application/service initiated LCS requests.

MLP:::
  Location requests can be sent to the {this-platform} {this-application} using plain XML over HTTP(S), with the request being encoded in OMA MLP (Mobile Location Protocol). See the full OMA MLP technical specification here: http://technical.openmobilealliance.org/Technical/technical-information/release-program/current-releases/mlp-v3-1

JAIN SLEE:::
  JAIN SLEE (Java API for Integrated Networks Service Logic Execution Environment) specification constitutes the JAVA community framework for the high standards in terms of performance, availability, portability, scalability, robustness, event oriented execution logic, etc., suitable for services/applications inter-working within telecommunication networks.
  JAIN SLEE architecture, through its Resource Adaptors (RA), adjusts information from peripheral agents of the SLEE, namely: Mobile Switching Centre Servers (MSC/MSCS), Media Gateways (MGW, MGC/MGCF), Signaling Gateways (SGW), Mobility Management Entities (MME), SIP servers/proxies like Serving/Interrogating/Proxy-Call Session Control Functions (S-CSCF, I-CSCF, P-CSCF), Media Resource Function Control, mobile subscribers data base query to HSS/HLR through Diameter/MAP respectively, Signaling Control Points (SCP) through CAP/INAP, and other service protocols like SOAP (Simple Object Access Protocol), OSA/Parlay, LDAP (Lightweight Directory Access Protocol), JDBC (Java Data Base Connectivity), JPA (Java Persistence API), etc.
  The components that carry out logic implementation of services/applications according to JAIN SLEE are named Service Building Blocks or SBB. The SBB are executed within a «components container», which controls their life cycle and eases their composition. An SBB may comprise multiple child SBBs, which are also reusable for other services, encompassing Java code usually generated in a dynamic Service Creation Environment or SCE (e.g. RestComm Visual Designer RVD) or middleware platforms containing JAIN SLEE SBBs (e.g. RestComm GMLC).
  JAIN SLEE service developer undergoes SBB construction by gathering logic items which represent events during the process of a service. As JAIN SLEE has been specially designed for event oriented logic execution, services are initiated by events like Diameter Requests/Answers. The generated SBBs then act together with the RAs under the JAIN SLEE framework so as to provide service to diverse external entities.  Every arriving event at the SLEE through the RAs is distributed among the SBBs in order to process them. This functionality is carried out by the «event router» as it is named within the functional structure of the JAIN SLEE framework.

Easy Configuration and Management:::
  {this-platform} {this-application} comes with an efficient Command Line Interface (CLI) tool allowing you to completely configure the  Gateway at run-time and manage it using simple commands rather than do everything manually.
  {this-platform} {this-application} also comes with a Graphical User Interface that will allow you to configure, monitor and manage the Gateway through a convenient user-friendly interface.

Next figure shows an architectural overview of {this-platform} {this-application} and its external interfaces, servers and clients, either within the infrastructure of a Mobile Network Operator or the Internet and specifically, with Restcomm Geolocation API.

image::images/GMLC_Architecture.png[]

[[_mobicents_gmlc_overview_tech_spec]]
=== Technical Specifications

{this-platform} {this-application} is not restricted by Transaction Per Second model.
The only restricting factor is memory + CPU capacity of the host servers, third-party applications or the underlying database service.

* {this-platform} {this-application} supports as many as 1073741823 incoming and 1073741823 outgoing concurrent sessions/dialogs.
* {this-platform} {this-application} supports unlimited E1 links and the only limiting factor is the underlying TDM board used.
* {this-platform} {this-application} SCTP supports as many associations as supported by the underlying Operating System.
  Can be setup in multihome.
* {this-platform} {this-application} M3UA can be confgured to have as many ASP's / IPSP's as needed by the system.
* {this-platform} {this-application} SCCP can be confgured to have virtually unlimited Global Title Translation rules and also supports wild characters for partial matching of Global Title digits.

[[_mobicents_gmlc_overview_http]]
=== HTTP Transfer Mechanism

{this-platform} {this-application} makes use of HTTP protocol between the gateway and the third-party applications (or Value Added Service Modules). {this-platform} {this-application} receives location service requests from third-party applications and then translates these requests to SS7 MAP or Diameter based commands when applies. The HTTP callback mechanism allows the third-party application to be agnostic to Operating System, Programming Language and Framework.
The third-party application can be either of the following technologies on any Operating System:

* Apache Tomcat, JBoss AS, Oracle Application Server, IBM Websphere, etc. for JSP/Servlet on Java
* PHP
* Microsoft IIS for ASP
